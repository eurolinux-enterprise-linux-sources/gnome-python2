# -*- python -*-
# encoding: utf-8

import os

def configure(conf):
    conf.env.append_value('MODULES_AVAILABLE', 'gnomecanvas')
    
    if 'gnomecanvas' in conf.env['ENABLE_MODULES'] or 'all' in conf.env['ENABLE_MODULES']:
        if conf.pkg_check_modules('GNOMECANVAS', 'libgnomecanvas-2.0 >= 2.8.0 pygobject-2.0 ',
                                  mandatory=False):
            conf.env.append_value('MODULES_TO_BUILD', 'gnomecanvas')


def build(bld):
    env = bld.env
    if 'gnomecanvas' in env['MODULES_TO_BUILD']:
        bld.codegen('canvas', local_load_types=['../bonobo/bonobo-arg-types.py'],
                    local_register=['../gnome/gnome-types.defs',
                                    'canvas.defs',
                                    '../bonobo/bonobo-types.defs'],
                    register=[os.path.join(env['PYGTK_DEFSDIR'], 'pango-types.defs'),
                              os.path.join(env['PYGTK_DEFSDIR'], 'gdk-types.defs'),
                              os.path.join(env['PYGTK_DEFSDIR'], 'gtk-types.defs')])

        pyext = bld.create_pyext()
        pyext.source = 'canvasmodule.c canvas.c'
        pyext.target = 'gnomecanvas'
        pyext.uselib = 'GNOMECANVAS'
        pyext.install_path = '${PYTHONDIR}/gtk-2.0'

        bld.install_files('${DATADIR}/pygtk/2.0/defs',
                          ['canvas.defs'])

